<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ Pet Shop Transport</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(135deg, #e0f2fe 0%, #e9d5ff 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 32px; color: #1f2937; margin-bottom: 8px; }
        .header p { color: #6b7280; font-size: 16px; }
        .user-badge { background: #3b82f6; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }
        .user-badge.admin { background: #10b981; }
        .sync-status { background: #fef3c7; padding: 10px 20px; border-radius: 8px; margin: 15px 0; font-size: 14px; color: #92400e; display: flex; justify-content: space-between; align-items: center; }
        .sync-btn { background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .add-btn { width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; display: none; }
        .add-btn.visible { display: block; }
        .add-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .form-container { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 30px; display: none; }
        .form-container.active { display: block; }
        .form-container h2 { font-size: 24px; color: #1f2937; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #3b82f6; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .submit-btn { width: 100%; background: #10b981; color: white; border: none; padding: 14px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .submit-btn:hover { background: #059669; }
        .submit-btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .pets-list { display: grid; gap: 20px; }
        .pet-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 25px; border-left: 5px solid #3b82f6; }
        .pet-card.arquivado { border-left: 5px solid #9ca3af; opacity: 0.7; background: #f9fafb; }
        .pet-card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px; }
        .pet-card-header h3 { font-size: 28px; color: #1f2937; margin-bottom: 5px; }
        .pet-card-header p { font-size: 18px; color: #6b7280; }
        .badge-status { background: #f59e0b; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-status.aguardando { background: #f59e0b; }
        .badge-status.caminho { background: #3b82f6; }
        .badge-status.entregue { background: #10b981; }
        .badge-status.pago { background: #8b5cf6; }
        .delete-btn { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.3s; display: none; }
        .delete-btn.visible { display: block; }
        .delete-btn:hover { background: #dc2626; }
        .pet-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; font-size: 14px; }
        .pet-info-item { color: #4b5563; }
        .pet-info-item strong { color: #374151; }
        .pet-address { margin-bottom: 15px; padding: 12px; background: #f3f4f6; border-radius: 8px; }
        .pet-address p { color: #374151; margin-bottom: 8px; font-size: 14px; }
        .status-section { padding-top: 20px; border-top: 2px solid #e5e7eb; }
        .status-buttons { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 15px; }
        .status-btn { flex: 1; min-width: 140px; padding: 12px; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; background: #e5e7eb; color: #374151; }
        .status-btn.active { background: #3b82f6; color: white; }
        .status-btn.pago-btn { background: #8b5cf6; color: white; }
        .status-btn:hover:not(:disabled) { opacity: 0.9; }
        .status-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .observacoes-container { margin-top: 15px; }
        .observacoes-label { font-weight: 600; color: #374151; font-size: 14px; margin-bottom: 8px; display: block; }
        .observacoes { width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-family: inherit; font-size: 14px; margin-bottom: 10px; }
        .observacoes-admin { border-color: #10b981; background: #f0fdf4; }
        .observacoes-motorista { border-color: #3b82f6; background: #eff6ff; }
        .empty-state { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 60px 30px; text-align: center; color: #6b7280; }
        .empty-state p:first-child { font-size: 20px; margin-bottom: 10px; }
        .empty-state p:last-child { font-size: 14px; }
        @media (max-width: 768px) {
            .form-row, .status-buttons { grid-template-columns: 1fr; flex-direction: column; }
            .status-btn { min-width: 100%; }
            .header { flex-direction: column; text-align: center; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üêæ Pet Shop Transport</h1>
                <p id="userRole">Sistema de transporte de pets</p>
            </div>
            <div class="user-badge" id="userBadge">Motorista</div>
        </div>
        
        <div class="sync-status" id="syncStatus">
            <span>‚úÖ Conectado | √öltima atualiza√ß√£o: <span id="lastUpdate">--:--:--</span></span>
            <button class="sync-btn" onclick="carregarPets()">Atualizar</button>
        </div>
        
        <button class="add-btn" id="addBtn" onclick="mostrarFormulario()">‚ûï Adicionar Pet</button>
        
        <div class="form-container" id="formContainer">
            <h2>üìù Novo Transporte</h2>
            <div class="form-group"><label>Cliente</label><input type="text" id="cliente" placeholder="Ex: Bil Silva"></div>
            <div class="form-row">
                <div class="form-group"><label>Pet</label><select id="pet" onchange="atualizarRacas()"><option>Cachorro</option><option>Gato</option><option>Outro</option></select></div>
                <div class="form-group"><label>Ra√ßa</label><select id="raca"></select></div>
                <div class="form-group"><label>Cor</label><select id="cor"><option>Marrom</option><option>Branco</option><option>Preto</option><option>Caramelo</option><option>Cinza</option><option>Malhado</option><option>Outra</option></select></div>
            </div>
            <div class="form-group"><label>Nome do Pet</label><input type="text" id="nomePet" placeholder="Ex: Nick"></div>
            <div class="form-group"><label>Endere√ßo</label><input type="text" id="endereco" placeholder="Ex: Av. Nossa Sr da Sa√∫de 403"></div>
            <div class="form-row">
                <div class="form-group"><label>Tempo do Percurso</label><input type="text" id="tempo" placeholder="Ex: 12 minutos"></div>
                <div class="form-group"><label>Hora Retirada</label><input type="time" id="horaRetirada" value="14:30"></div>
            </div>
            <button class="submit-btn" onclick="adicionarPet()">Adicionar Pet</button>
        </div>
        
        <div class="pets-list" id="petsList"></div>
    </div>

    <script>
        // ========== CONFIGURA√á√ÉO ==========
        const JSONBIN_CONFIG = {
            BIN_ID: '695de16743b1c97be91e7eeb',
            API_KEY: '$2a$10$Wmft46BmqMcXpiI3zbasQ.4xVnNwAtOSxia383nb1GxXxojFbX.Nm', // COLE SUA CHAVE AQUI
            API_URL: 'https://api.jsonbin.io/v3/b'
        };

        // Detectar modo
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('modo') === 'admin';

        let pets = [];

        // ========== FUN√á√ïES B√ÅSICAS ==========
        function configurarInterface() {
            const addBtn = document.getElementById('addBtn');
            const userBadge = document.getElementById('userBadge');
            const userRole = document.getElementById('userRole');
            
            if (isAdmin) {
                addBtn.classList.add('visible');
                userBadge.textContent = 'Administrador';
                userBadge.classList.add('admin');
                userRole.textContent = 'Sistema de transporte - Modo Administrador';
            } else {
                addBtn.classList.remove('visible');
                userBadge.textContent = 'Motorista';
                userBadge.classList.remove('admin');
                userRole.textContent = 'Sistema de transporte - Modo Motorista';
            }
            
            // Inicializar ra√ßas
            atualizarRacas();
        }

        function atualizarRacas() {
            const racas = {
                'Cachorro': ['Shitzu', 'Poodle', 'Labrador', 'Bulldog', 'Golden', 'Vira-lata', 'Outro'],
                'Gato': ['Persa', 'Siam√™s', 'Maine Coon', 'Vira-lata', 'Outro'],
                'Outro': ['N√£o especificado']
            };
            const pet = document.getElementById('pet').value;
            const select = document.getElementById('raca');
            select.innerHTML = '';
            racas[pet].forEach(raca => {
                const option = document.createElement('option');
                option.value = raca;
                option.textContent = raca;
                select.appendChild(option);
            });
        }

        function mostrarFormulario() {
            if (!isAdmin) return;
            const form = document.getElementById('formContainer');
            const btn = document.getElementById('addBtn');
            form.classList.toggle('active');
            btn.textContent = form.classList.contains('active') ? '‚ùå Cancelar' : '‚ûï Adicionar Pet';
        }

        // ========== FUN√á√ïES JSONBIN ==========
        async function carregarPets() {
            try {
                const response = await fetch(`${JSONBIN_CONFIG.API_URL}/${JSONBIN_CONFIG.BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': JSONBIN_CONFIG.API_KEY }
                });
                const data = await response.json();
                pets = data.record?.pets || [];
                mostrarPets();
                atualizarHora();
            } catch (error) {
                console.log('Usando dados locais');
                const local = localStorage.getItem('meusPets');
                pets = local ? JSON.parse(local) : [];
                mostrarPets();
            }
        }

        async function salvarPets() {
            const dadosParaSalvar = { pets };
            try {
                await fetch(`${JSONBIN_CONFIG.API_URL}/${JSONBIN_CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosParaSalvar)
                });
                localStorage.setItem('meusPets', JSON.stringify(pets));
            } catch (error) {
                localStorage.setItem('meusPets', JSON.stringify(pets));
            }
        }

        // ========== CRUD PETS ==========
        async function adicionarPet() {
            if (!isAdmin) return;
            
            const pet = {
                id: Date.now(),
                cliente: document.getElementById('cliente').value.trim(),
                pet: document.getElementById('pet').value,
                raca: document.getElementById('raca').value,
                cor: document.getElementById('cor').value,
                nomePet: document.getElementById('nomePet').value.trim(),
                endereco: document.getElementById('endereco').value.trim(),
                tempo: document.getElementById('tempo').value.trim(),
                horaRetirada: document.getElementById('horaRetirada').value || '14:30',
                status: 'Aguardando retirada',
                pagamento: 'Pendente',
                observacoesAdmin: '',       // Observa√ß√£o do ADMIN
                observacoesMotorista: '',   // Observa√ß√£o do MOTORISTA
                dataCriacao: new Date().toISOString()
            };

            // Validar
            if (!pet.cliente || !pet.raca || !pet.nomePet || !pet.endereco) {
                alert('Preencha todos os campos!');
                return;
            }

            pets.push(pet);
            await salvarPets();
            
            // Limpar formul√°rio
            ['cliente', 'nomePet', 'endereco', 'tempo'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('horaRetirada').value = '14:30';
            
            mostrarFormulario();
            mostrarPets();
        }

        async function atualizarPetStatus(petId, campo, valor) {
            // ADMIN N√ÉO PODE ALTERAR STATUS, s√≥ motorista
            if (isAdmin) return;
            
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            pet[campo] = valor;
            
            // Se marcou como pago, arquivar
            if (campo === 'pagamento' && valor === 'Pago') {
                pet.arquivado = true;
            }
            
            await salvarPets();
            mostrarPets();
        }

        async function atualizarObservacoes(petId, tipo, texto) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            // Cada um atualiza sua pr√≥pria observa√ß√£o
            if (tipo === 'admin') {
                pet.observacoesAdmin = texto;
            } else {
                pet.observacoesMotorista = texto;
            }
            
            await salvarPets();
        }

        async function removerPet(petId) {
            if (!isAdmin || !confirm('Remover este pet?')) return;
            
            pets = pets.filter(p => p.id !== petId);
            await salvarPets();
            mostrarPets();
        }

        // ========== RENDERIZAR PETS ==========
        function mostrarPets() {
            const container = document.getElementById('petsList');
            
            // Filtrar para motorista
            let petsVisiveis = isAdmin ? pets : pets.filter(p => !p.arquivado && p.pagamento !== 'Pago');
            
            if (petsVisiveis.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>${isAdmin ? 'üìã Nenhum pet cadastrado' : 'üì≠ Nenhum pet para transporte'}</p>
                        <p>${isAdmin ? 'Adicione o primeiro pet!' : 'Aguardando novos pets'}</p>
                    </div>
                `;
                return;
            }

            // Ordenar por hora
            petsVisiveis.sort((a, b) => (a.horaRetirada || '').localeCompare(b.horaRetirada || ''));

            container.innerHTML = petsVisiveis.map(pet => `
                <div class="pet-card ${pet.arquivado ? 'arquivado' : ''}">
                    <div class="pet-card-header">
                        <div>
                            <h3>${pet.nomePet}</h3>
                            <p>${pet.cliente}</p>
                            <span class="badge-status ${pet.status.replace(/ /g, '-').toLowerCase()}">
                                ${pet.status}
                            </span>
                            ${pet.pagamento === 'Pago' ? '<span class="badge-status pago">Pago</span>' : ''}
                        </div>
                        <div>
                            <div style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">
                                ‚è∞ ${pet.horaRetirada || '--:--'}
                            </div>
                            ${isAdmin ? `<button class="delete-btn visible" onclick="removerPet(${pet.id})">üóëÔ∏è Remover</button>` : ''}
                        </div>
                    </div>
                    
                    <div class="pet-info">
                        <div class="pet-info-item"><strong>Pet:</strong> ${pet.pet}</div>
                        <div class="pet-info-item"><strong>Ra√ßa:</strong> ${pet.raca}</div>
                        <div class="pet-info-item"><strong>Cor:</strong> ${pet.cor}</div>
                        <div class="pet-info-item"><strong>Tempo:</strong> ${pet.tempo}</div>
                    </div>
                    
                    <div class="pet-address">
                        <p>üìç <strong>Endere√ßo:</strong> ${pet.endereco}</p>
                    </div>
                    
                    <div class="status-section">
                        <!-- BOT√ïES DE STATUS (S√ì MOTORISTA V√ä/ USA) -->
                        ${!isAdmin ? `
                            <div class="status-buttons">
                                ${['Aguardando retirada', 'A caminho da loja', 'A caminho da entrega', 'Entregue'].map(status => `
                                    <button class="status-btn ${pet.status === status ? 'active' : ''}" 
                                            onclick="atualizarPetStatus(${pet.id}, 'status', '${status}')"
                                            ${pet.arquivado ? 'disabled' : ''}>
                                        ${status}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <button class="status-btn ${pet.pagamento === 'Pago' ? 'pago-btn' : ''}" 
                                        onclick="atualizarPetStatus(${pet.id}, 'pagamento', '${pet.pagamento === 'Pago' ? 'Pendente' : 'Pago'}')"
                                        ${pet.arquivado ? 'disabled' : ''}>
                                    ${pet.pagamento === 'Pago' ? '‚úì Pago' : 'Marcar como Pago'}
                                </button>
                            </div>
                        ` : `
                            <!-- ADMIN s√≥ v√™ o status atual -->
                            <div style="margin-bottom: 15px;">
                                <strong>Status atual:</strong> ${pet.status}
                                ${pet.pagamento === 'Pago' ? ' | <strong>Pagamento:</strong> Pago' : ''}
                            </div>
                        `}
                        
                        <!-- OBSERVA√á√ïES SEPARADAS -->
                        <div class="observacoes-container">
                            ${isAdmin ? `
                                <!-- ADMIN v√™ e edita SUA observa√ß√£o -->
                                <div>
                                    <span class="observacoes-label">üìù Minhas Observa√ß√µes (Admin):</span>
                                    <textarea class="observacoes observacoes-admin" 
                                              onchange="atualizarObservacoes(${pet.id}, 'admin', this.value)"
                                              placeholder="Digite observa√ß√µes administrativas...">${pet.observacoesAdmin || ''}</textarea>
                                    
                                    <span class="observacoes-label">üìù Observa√ß√µes do Motorista:</span>
                                    <textarea class="observacoes observacoes-motorista" 
                                              readonly
                                              placeholder="Observa√ß√µes do motorista aparecer√£o aqui...">${pet.observacoesMotorista || ''}</textarea>
                                </div>
                            ` : `
                                <!-- MOTORISTA v√™ e edita SUA observa√ß√£o -->
                                <div>
                                    <span class="observacoes-label">üìù Observa√ß√µes do Admin:</span>
                                    <textarea class="observacoes observacoes-admin" 
                                              readonly
                                              placeholder="Observa√ß√µes do admin aparecer√£o aqui...">${pet.observacoesAdmin || ''}</textarea>
                                    
                                    <span class="observacoes-label">üìù Minhas Observa√ß√µes (Motorista):</span>
                                    <textarea class="observacoes observacoes-motorista" 
                                              onchange="atualizarObservacoes(${pet.id}, 'motorista', this.value)"
                                              placeholder="Digite suas observa√ß√µes...">${pet.observacoesMotorista || ''}</textarea>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `).join('');
            
            atualizarHora();
        }

        function atualizarHora() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('pt-BR');
        }

        // ========== INICIAR ==========
        document.addEventListener('DOMContentLoaded', () => {
            configurarInterface();
            carregarPets();
            
            // Atualizar automaticamente
            setInterval(carregarPets, 30000);
        });
    </script>
</body>
</html>
